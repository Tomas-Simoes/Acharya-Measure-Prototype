service: acharya-test-ml
provider:
  name: aws
  runtime: python3.8
  stage: dev
  region: eu-west-1
  iam:
    role:
      statements:
        - Effect: "Allow"
          Action:
            - "ecr:InitiateLayerUpload"
            - "ecr:SetRepositoryPolicy"
            - "ecr:GetRepositoryPolicy"
          Resource:
            !Join 
              - ':'
              - - 'arn:aws:ecr'
                - Ref: AWS::Region
                - Ref: AWS::AccountId
                - 'repository/*'
plugins:
# - serverless-python-requirements
  - serverless-offline

custom:
  pythonRequirements:
    dockerizePip: true
  cors:
    origins:
      - 'http://localhost:8080'
    headers:
      - Content-Type
    allowCredentials: true

functions:
  main:
    image: 550512796301.dkr.ecr.eu-west-1.amazonaws.com/acharya-prototype-ml:test
    timeout: 900
    events:
      - http: 
          path: /test 
          method: POST
  #  timeout: 30
  #  handler: AcharyaMeasuringPrototype.init
  #  package:
  #    include:
  #      - AcharyaMeasuringPrototype.py
  #      - Utlis.py
  #      - Models/best.pt

  #health:
  #  timeout: 30
  #  handler: AcharyaMeasuringPrototype.health
  #  package:
  #    include:
  #      - AcharyaMeasuringPrototype.py
  #  events:
  #    - http: 
  #        path: /health
  #        method: GET
